<!DOCTYPE html>
<html>
    <head>
    <!-- Title -->
    
    <title>
        Android TabLayout分析 | Snowbean&#39;s Blog
    </title>
    
    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon.png">
    <link rel="icon" sizes="192x192" href="/img/favicon.png">
    <link rel="apple-touch-icon" href="/img/favicon.png">
    
    <!-- Meta & INfo -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Snowbean">
    <meta name="description" content="Keep Calm and Carry on!">
    <meta name="keywords" content="null">
    
    <!--iOS -->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">
    
    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Snowbean&#39;s Blog">
    
    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://wuapnjie.github.io">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Android TabLayout分析 | Snowbean&#39;s Blog">
    <meta property="og:description" content="Keep Calm and Carry on!">
    
     <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">
        
        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->
    
    <!-- Import CSS -->
    <link rel="stylesheet" href="/css/material.min.css">
    <link rel="stylesheet" href="/css/style.min.css">
    <!-- Config CSS -->


<!-- Other Styles -->
<style>
	body, html{
		font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
	}
	
    a{
        color: #00838F
    }
    
    .mdl-card__media,
    #search-label,
    #search-form-label:after,
    #scheme-Paradox .hot_tags-count,
    #scheme-Paradox .sidebar_archives-count,
    #scheme-Paradox .sidebar-colored .sidebar-header,
    #scheme-Paradox .sidebar-colored .sidebar-badge{
        background-color: #0097A7 !important
    }
    
	/* Sidebar User Drop Down Menu Text Color */
	#scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
    #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus{
        color: #0097A7 !important
    }
    
    #post_entry-right-info,
    .sidebar-colored .sidebar-nav li:hover > a,
    .sidebar-colored .sidebar-nav li:hover > a i,
    .sidebar-colored .sidebar-nav li > a:hover,
    .sidebar-colored .sidebar-nav li > a:hover i,
    .sidebar-colored .sidebar-nav li > a:focus i,
    .sidebar-colored .sidebar-nav > .open > a,
    .sidebar-colored .sidebar-nav > .open > a:hover,
    .sidebar-colored .sidebar-nav > .open > a:focus,
    #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a{
        color: #0097A7 !important
    }
    
    .toTop{
        background: #757575 !important
    }
		
	.material-layout .material-post>.material-nav,
	.material-layout .material-index>.material-nav,
	.material-nav a{
		color: #757575;
	}
		
	#scheme-Paradox .MD-burger-layer {
		background-color: #757575;
	}

	#scheme-Paradox #post-toc-trigger-btn{
		color: #757575;
	}
	
	.post-toc a:hover{
		color: #00838F;
		text-decoration: underline;
	}
</style>


<!-- Theme Background Related-->

    <style>
        body{
            background-color: #F5F5F5
        }
		
		/* blog_info bottom background */
        #scheme-Paradox .material-layout .something-else .mdl-card__supporting-text{
            background-color: #fff;
        }
    </style>




<!-- Fade Effect -->

    <style>
        .fade {
            transition: all 800ms linear;
            -webkit-transform: translate3d(0,0,0);
            -moz-transform: translate3d(0,0,0);
            -ms-transform: translate3d(0,0,0);
            -o-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
            opacity: 1;
        }

        .fade.out{
            opacity: 0;
        }
    </style>

	<script src="/js/jquery.min.js"></script>
	
	<link rel="stylesheet" href="/css/highlight/solarized-white.css">
	
	<!-- UC Browser Compatible-->
	<script>
		var agent = navigator.userAgent.toLowerCase();
		if(agent.indexOf('ucbrowser')>0) {
			document.write('<link rel="stylesheet" href="/css/uc.css">');
		   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
		}
	</script>
    
    <!-- Custom Head -->
    
</head>
	
	

    <body id="scheme-Paradox">

		
        <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
				
			
			
            <!-- Main Container -->
            <main class="material-layout__content" id="main">
				
                <!-- Top Anchor -->
                <div id="top"></div>
				
				
                <!-- Hamburger Button -->
                <button class="MD-burger-icon sidebar-toggle">
                    <span class="MD-burger-layer"></span>
                </button>
				
				
                <!-- Post TOC -->

    
	<!-- Back Button -->
<!--
	<div class="material-back" id="backhome-div" tabindex="0">
		<a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" href="#" onclick="window.history.back();return false;" target="_self" role="button" data-upgraded=",MaterialButton,MaterialRipple">
			<i class="material-icons" role="presentation">arrow_back</i>
			<span class="mdl-button__ripple-container">
				<span class="mdl-ripple"></span>
			</span>
		</a>
	</div>			
-->
	<!-- Left aligned menu below button -->
	<button id="post-toc-trigger-btn"
			class="mdl-button mdl-js-button mdl-button--icon">
	  <i class="material-icons">format_list_numbered</i>
	</button>

	<ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect"
		for="post-toc-trigger-btn">
			
			<ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#TabLayout的构造方法分析"><span class="post-toc-number">1.</span> <span class="post-toc-text">TabLayout的构造方法分析</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#TabLayout与ViewPager的搭配使用分析"><span class="post-toc-number">2.</span> <span class="post-toc-text">TabLayout与ViewPager的搭配使用分析</span></a></li></ol>
		
<!--			<li class="mdl-menu__item">Some Action</li>-->
	</ul>



<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">
		
        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
	<!-- Paradox Post Header -->
	
		
			<!-- Random Thumbnail -->
			<div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
				<script>
    
    var randomNum;
    randomNum = Math.floor(Math.random() * 5 + 1);
    
    $(".post_thumbnail-random").css('background-image', 'url(' + '/img/random/' + randomNum + '.png' + ')');
    
</script>

		
	
        <p class="article-headline-p">
            Android TabLayout分析
        </p>
    </div>

	

				
				
					<!-- Paradox Post Info -->
					<div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">
    
    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Snowbean</strong>
        <span>9月 08, 2016</span>
    </div>
    
    <div class="section-spacer"></div>
	
    <!-- Favorite -->
<!--
    <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
        <i class="material-icons" role="presentation">favorite</i>
        <span class="visuallyhidden">favorites</span>
    </button>
-->
    
    <!-- Tags (bookmark) -->
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/Android/">Android</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/Android-View/">Android View</a>
    </ul>
    
    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    
    
    
    
    <!-- Share Twitter -->
    <a class="post_share-link" href="https://twitter.com/intent/tweet?text=Android TabLayout分析&url=http://wuapnjie.github.io//2016/09/08/Android TabLayout分析/index.html&via=Snowbean" target="_blank">
        <li class="mdl-menu__item">
            分享到 Twitter
        </li>
    </a>
    
    <!-- Share Google+ -->
    <a class="post_share-link" href="https://plus.google.com/share?url=http://wuapnjie.github.io//2016/09/08/Android TabLayout分析/index.html" target="_blank">
        <li class="mdl-menu__item">
            分享到 Google+
        </li>
    </a>
    
    <!-- Share Weibo -->
    <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Android TabLayout分析&url=http://wuapnjie.github.io//2016/09/08/Android TabLayout分析/index.html&pic=&searchPic=false&style=simple" target="_blank">
        <li class="mdl-menu__item">
            分享到微博
        </li>
    </a>
</ul>
</div>
				

                <!-- Post Content -->
                <div id="post-content" class="markdown-Github mdl-color-text--grey-700 mdl-card__supporting-text fade out">
	
		<h1 id="TabLayout的构造方法分析"><a href="#TabLayout的构造方法分析" class="headerlink" title="TabLayout的构造方法分析"></a>TabLayout的构造方法分析</h1><p>在我自己制作小APP时，经常使用TabLayout，于是就想看看它是怎么实现的。<br>点进TabLayout类查看源码，发现它继承自HorizontalScrollView<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TabLayout</span> <span class="keyword">extends</span> <span class="title">HorizontalScrollView</span></span></div></pre></td></tr></table></figure></p>
<p>的确，当我们将TabLayout的Mode设为MODE_SCROLLABLE时，它的确是横向可滑动的，之前并不知道源码应该怎么看，但感觉应该从构造方法开始看起。接下来看看TabLayout在初始化时做了些什么。<br>我们都知道，如果在XML中使用TabLayout，会默认使用2个参数的构造函数<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">TabLayout</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里调用了3个参数的构造方法，哈哈，好吧，其实大家都这么写，1个参数的构造方法调用2个参数，2个参数的构造方法调用3个的。那么直接看3个参数的构造方法里做了一些<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">TabLayout</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line"></div><div class="line">        <span class="comment">// 1 见下方</span></div><div class="line">        ThemeUtils.checkAppCompatTheme(context);</div><div class="line">        <span class="comment">// 2</span></div><div class="line">        <span class="comment">// Disable the Scroll Bar 不显示滚动条</span></div><div class="line">        setHorizontalScrollBarEnabled(<span class="keyword">false</span>);</div><div class="line">        <span class="comment">// 3</span></div><div class="line">        <span class="comment">// Add the TabStrip</span></div><div class="line">        mTabStrip = <span class="keyword">new</span> SlidingTabStrip(context);</div><div class="line">        <span class="keyword">super</span>.addView(mTabStrip, <span class="number">0</span>, <span class="keyword">new</span> HorizontalScrollView.LayoutParams(</div><div class="line">                LayoutParams.WRAP_CONTENT, LayoutParams.MATCH_PARENT));</div><div class="line"></div><div class="line">        <span class="comment">//这里省略了很多代码，就是从XML里读取一些自定义的属性</span></div><div class="line">        TypedArray a = context.obtainStyledAttributes(attrs, R.styleable.TabLayout,</div><div class="line">                defStyleAttr, R.style.Widget_Design_TabLayout);</div><div class="line"></div><div class="line">       ……</div><div class="line"></div><div class="line">        <span class="comment">// 4</span></div><div class="line">        <span class="comment">// Now apply the tab mode and gravity</span></div><div class="line">        applyModeAndGravity();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>从构造方法中我们知道了TabLayout在创建时会先检查当前的Activity的Theme是否是Theme.AppCompat系的（上方代码1处），肯定TabLayout依赖了很多在这个主题系里定义的属性，如果不是，这里会抛出一个异常，代码也非常简单<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">checkAppCompatTheme</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        TypedArray a = context.obtainStyledAttributes(APPCOMPAT_CHECK_ATTRS);</div><div class="line">        <span class="keyword">final</span> <span class="keyword">boolean</span> failed = !a.hasValue(<span class="number">0</span>);</div><div class="line">        <span class="keyword">if</span> (a != <span class="keyword">null</span>) &#123;</div><div class="line">            a.recycle();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (failed) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"You need to use a Theme.AppCompat theme "</span></div><div class="line">                    + <span class="string">"(or descendant) with the design library."</span>);</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后令横向滚动条消失（代码2处），哈哈，不然多违和。之后创建了一个SlidingTabStrip的实例（代码3处），并把它加进了TabLayout中，那么问题来了，这是个什么东西，于是Ctrl+右键点进去看，发现是一个定义在TabLayout内的继承自LinearLayout的内部类<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">SlidingTabStrip</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span></span></div></pre></td></tr></table></figure></p>
<p>哦，是个线性布局，哈哈那肯定是个横向的线性布局，恩，不要问我怎么知道的，聪明的人都知道，看看它的构造方法里做了什么，里面只有一个构造方法。<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">SlidingTabStrip(Context context) &#123;</div><div class="line">            <span class="keyword">super</span>(context);</div><div class="line">            setWillNotDraw(<span class="keyword">false</span>);</div><div class="line">            mSelectedIndicatorPaint = <span class="keyword">new</span> Paint();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>恩，除了调用父类的构造方法外只做了两件事情，第一件事是告诉夫布局我是一个要自己画自己的线性布局，然后第二件事就是初始化了一支画笔mSelectedIndicatorPaint。从名字中我们可以看出，它要花的是指示器，恩，指示器就是这个东西，下图中的黄条。<br><img src="http://static.zybuluo.com/wuapnjie/folma3ak8fb9hna34s1u8q7h/components_tabs_usage_mobile3.png" alt="components_tabs_usage_mobile3.png-11.1kB"></p>
<p>然后这个内部类里声明了和指示器有关的各种方法，以后会分析的。<br>回到TabLayout的构造方法，获取了许多自定义的属性后，调用了applyModeAndGravity()这个方法（代码4处），看名字是让我们设置的TabLayout的Mode和Gravity生效，看一下具体做了什么事情。<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">applyModeAndGravity</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> paddingStart = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> (mMode == MODE_SCROLLABLE) &#123;</div><div class="line">            <span class="comment">// If we're scrollable, or fixed at start, inset using padding</span></div><div class="line">            paddingStart = Math.max(<span class="number">0</span>, mContentInsetStart - mTabPaddingStart);</div><div class="line">        &#125;</div><div class="line">        ViewCompat.setPaddingRelative(mTabStrip, paddingStart, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line"></div><div class="line">        <span class="keyword">switch</span> (mMode) &#123;</div><div class="line">            <span class="keyword">case</span> MODE_FIXED:</div><div class="line">                mTabStrip.setGravity(Gravity.CENTER_HORIZONTAL);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> MODE_SCROLLABLE:</div><div class="line">                mTabStrip.setGravity(GravityCompat.START);</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        updateTabViews(<span class="keyword">true</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>就是如果我们把TabLayout的Mode设为MODE_SCROLLABLE后，且在layout中使用<br><figure class="highlight xml"><table><tr><td class="code"><pre><div class="line">app:tabContentStart="100dp"</div></pre></td></tr></table></figure></p>
<p>这个属性后，TabLayout会有一个padding_start，效果就是这样<br><img src="http://static.zybuluo.com/wuapnjie/009wt6qorxs3epe0jp0u0xv2/TabLayout-2.png" alt="TabLayout-2.png-3.2kB"><br>在一开始出现了内边距。<br>PS.在看这个东西源码的时候有ViewCompat这么好的用的类哈。<br>然后就是设置子View LinearLayout的Gravity。然后调用了updateTabViews(true)这个方法，点进去看看。<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateTabViews</span><span class="params">(<span class="keyword">final</span> <span class="keyword">boolean</span> requestLayout)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mTabStrip.getChildCount(); i++) &#123;</div><div class="line">        View child = mTabStrip.getChildAt(i);</div><div class="line">        child.setMinimumWidth(getTabMinWidth());</div><div class="line">        updateTabViewLayoutParams((LinearLayout.LayoutParams) child.getLayoutParams());</div><div class="line">        <span class="keyword">if</span> (requestLayout) &#123;</div><div class="line">            child.requestLayout();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>恩，很简单，就是把内部自定义的LinearLayout中的子View全部拿出，设置最小的宽度，这个会根据Mode的不同而的到不同的最小宽度,然后设置布局参数重新布局，看看updateTabViewLayoutParams这个方法。<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateTabViewLayoutParams</span><span class="params">(LinearLayout.LayoutParams lp)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mMode == MODE_FIXED &amp;&amp; mTabGravity == GRAVITY_FILL) &#123;</div><div class="line">            lp.width = <span class="number">0</span>;</div><div class="line">            lp.weight = <span class="number">1</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            lp.width = LinearLayout.LayoutParams.WRAP_CONTENT;</div><div class="line">            lp.weight = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>就是如果Mode为MODE_FIXED或TabLayout的Gravity属性为Fill的话，那么就把LayoutParam的width设为0，weight设为1，这在一个线性布局中就会有几个子View就会几等分，否则就是wrap_content。</p>
<p>好了构造方法分析完了，我们可以知道TabLayout的视图结构是这样子的<br><img src="http://static.zybuluo.com/wuapnjie/fg80tt1udyqmmxdnsbg9t8vm/TabLayout-3.svg" alt="TabLayout-3.svg-7kB"><br>看完构造方法我们还并不知道Item是什么，但是接下来的分析中我们会知道这是什么的。</p>
<p>#TabLayout的基本使用分析<br>恩，下面是代码<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">mTabLayout = (TabLayout) findViewById(R.id.tabLayout);</div><div class="line">mTabLayout.addTab(mTabLayout.newTab().setText(<span class="string">"Item1"</span>));</div><div class="line">mTabLayout.addTab(mTabLayout.newTab().setText(<span class="string">"Item2"</span>),<span class="number">1</span>);</div><div class="line">mTabLayout.addTab(mTabLayout.newTab().setText(<span class="string">"Item3"</span>),<span class="number">2</span>,<span class="keyword">true</span>);</div></pre></td></tr></table></figure></p>
<p>效果如下<br><img src="http://static.zybuluo.com/wuapnjie/psv6lmbvd9ahu9sf7ikk641g/TabLayout-4.png" alt="TabLayout-4.png-2.6kB"><br>看到我们成功添加了三个Tab，但是有bug，我们在加入Item3时设置了Item3被选中，但是Item1的文字颜色也是选中状态的颜色，有趣。<br>接下来我们分析TabLayout的addTab的三个方法。首先addTab最重要的参数肯定是Tab，而这个Tab是通过mTabLayout的newTab方法得到的，那么这个Tab是什么的呢，点进去查看，这是一个TabLayout内部的嵌套类。<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">    <span class="comment">/**</span></div><div class="line">     * A tab in this layout. Instances can be created via &#123;<span class="doctag">@link</span> #newTab()&#125;.</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Tab</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * An invalid position for a tab.</div><div class="line">         *</div><div class="line">         * <span class="doctag">@see</span> #getPosition()</div><div class="line">         */</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INVALID_POSITION = -<span class="number">1</span>;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> Object mTag;</div><div class="line">        <span class="keyword">private</span> Drawable mIcon;</div><div class="line">        <span class="keyword">private</span> CharSequence mText;</div><div class="line">        <span class="keyword">private</span> CharSequence mContentDesc;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> mPosition = INVALID_POSITION;</div><div class="line">        <span class="keyword">private</span> View mCustomView;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> TabLayout mParent;</div><div class="line">        <span class="keyword">private</span> TabView mView;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">private</span> <span class="title">Tab</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="comment">// Private constructor</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//一些get，set方法</span></div><div class="line">        ……</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateView</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (mView != <span class="keyword">null</span>) &#123;</div><div class="line">                mView.update();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span> </span>&#123;</div><div class="line">            mParent = <span class="keyword">null</span>;</div><div class="line">            mView = <span class="keyword">null</span>;</div><div class="line">            mTag = <span class="keyword">null</span>;</div><div class="line">            mIcon = <span class="keyword">null</span>;</div><div class="line">            mText = <span class="keyword">null</span>;</div><div class="line">            mContentDesc = <span class="keyword">null</span>;</div><div class="line">            mPosition = INVALID_POSITION;</div><div class="line">            mCustomView = <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">```        </div><div class="line">从代码中可以看出,Tab类是一个类似于Bean的类，储存了各种信息，并提供了仅供内部调用的更新和重置方法，相当与一个信息的载体。且构造方法私有，只能通过TabLayout的newTab()方法获取实例。</div><div class="line">从之前的分析我们可以知道，TabLayout肯定把Tab中的所带有的数据添加到了内部自定义的LinearLayout中，而这肯定是在addTab系列方法中完成，点击去查看这些addTab方法，发现调用的是<span class="number">2</span>个参数和<span class="number">3</span>个参数的方法，让我们看看源码。</div><div class="line">```<span class="function">java</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addTab</span><span class="params">(@NonNull Tab tab, <span class="keyword">boolean</span> setSelected)</span> &#123;</div><div class="line">        <span class="keyword">if</span> (tab.mParent != <span class="keyword">this</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Tab belongs to a different TabLayout."</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        addTabView(tab, setSelected);</div><div class="line">        configureTab(tab, mTabs.size());</div><div class="line">        <span class="keyword">if</span> (setSelected) &#123;</div><div class="line">            tab.select();</div><div class="line">        &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addTab</span><span class="params">(@NonNull Tab tab, <span class="keyword">int</span> position, <span class="keyword">boolean</span> setSelected)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (tab.mParent != <span class="keyword">this</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Tab belongs to a different TabLayout."</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        addTabView(tab, position, setSelected);</div><div class="line">        configureTab(tab, position);</div><div class="line">        <span class="keyword">if</span> (setSelected) &#123;</div><div class="line">            tab.select();</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到两个方法是很接近，所以我们只看一个，在addTab方法内部，先进行判断，传入的Tab实例的mParent属性是否为当前TabLayout的实例，说明在TabLayout调用newTab()方法生成Tab实例时初始话了Tab的mParent属性。之后调用了addTabView()和configureTab()这两个方法，让我们来看看这两个方法做了什么。<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addTabView</span><span class="params">(Tab tab, <span class="keyword">int</span> position, <span class="keyword">boolean</span> setSelected)</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> TabView tabView = tab.mView;</div><div class="line">        mTabStrip.addView(tabView, position, createLayoutParamsForTabs());</div><div class="line">        <span class="keyword">if</span> (setSelected) &#123;</div><div class="line">            tabView.setSelected(<span class="keyword">true</span>);</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>oh！在这个私有方法里生成了TabView实例并加入了mTabStrip中，恩，等等，好像漏了什么，tab.mView是什么时候声明的，再回去一看，是在TabLayout的newTab()方法中<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">public</span> Tab <span class="title">newTab</span><span class="params">()</span> </span>&#123;</div><div class="line">        Tab tab = sTabPool.acquire();</div><div class="line">        <span class="keyword">if</span> (tab == <span class="keyword">null</span>) &#123;</div><div class="line">            tab = <span class="keyword">new</span> Tab();</div><div class="line">        &#125;</div><div class="line">        tab.mParent = <span class="keyword">this</span>;</div><div class="line">        tab.mView = createTabView(tab);</div><div class="line">        <span class="keyword">return</span> tab;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>恩，这个方法就是从TabPool中取出一个Tab，然后在这这里才是真正的构造了一个TabView的实例，并赋给tab.mView。<br>虽然我们不知道TabView是什么还，但是这肯定就是之前的Item呀，于是TabLayout的视图结构就很清楚了。<br><img src="http://static.zybuluo.com/wuapnjie/q1j97shk7hshvqeuhpxsve8g/TabLayout-5.svg" alt="TabLayout-5.svg-7kB"></p>
<p>恩，不急，先分析完configureTab()这个方法再去看看TabView是怎么定义的。<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">configureTab</span><span class="params">(Tab tab, <span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">        tab.setPosition(position);</div><div class="line">        mTabs.add(position, tab);</div><div class="line"></div><div class="line">        <span class="keyword">final</span> <span class="keyword">int</span> count = mTabs.size();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = position + <span class="number">1</span>; i &lt; count; i++) &#123;</div><div class="line">            mTabs.get(i).setPosition(i);</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>恩，就是定义Tab的position属性，并加入到mTabs(ArrayList)这个容器中，并更新所有Tab的position属性，使其正确。<br>接下来我们看看TabView是如何定义的。<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TabView</span> <span class="keyword">extends</span> <span class="title">LinearLayout</span> <span class="keyword">implements</span> <span class="title">OnLongClickListener</span></span></div></pre></td></tr></table></figure></p>
<p>是一个内部的继承自LinearLayout的内部类。从构造方法中可以看出，这是一个垂直的可点击的线性布局<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">TabView</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>(context);</div><div class="line">            <span class="keyword">if</span> (mTabBackgroundResId != <span class="number">0</span>) &#123;</div><div class="line">                setBackgroundDrawable(</div><div class="line">                        AppCompatDrawableManager.get().getDrawable(context, mTabBackgroundResId));</div><div class="line">            &#125;</div><div class="line">            ViewCompat.setPaddingRelative(<span class="keyword">this</span>, mTabPaddingStart, mTabPaddingTop,</div><div class="line">                    mTabPaddingEnd, mTabPaddingBottom);</div><div class="line">            setGravity(Gravity.CENTER);</div><div class="line">            setOrientation(VERTICAL);</div><div class="line">            setClickable(<span class="keyword">true</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>且，内部有个update方法，会根据Tab中拥有的属性对其内部的View设置Visibility，比如我们上面只设置了Tab的text，所以TabView内部的ImageView和mCustomView就会被设置为GONE,我们只看得到内部的TextView。并且，当我们调用Tab的setXXX()方法都会调用TabView的update()方法来更新视图。</p>
<p>总结一下，TabView中有一个Tab实例，而Tab中也有一个TabView实例，两两对应，Tab作为数据的载体，储存了许多数据，比如要显示的文字，要显示的Icon，或者要显示的自定义View，而TabView负责显示这些数据，TabView内部有许多子View负责显示这些数据。并在某些没有数据时让负责显示这个数据的子View消失不显示。且Tab中的每个数据发生改变时都会提醒TabView，让其做出相应视图上的改变。</p>
<h1 id="TabLayout与ViewPager的搭配使用分析"><a href="#TabLayout与ViewPager的搭配使用分析" class="headerlink" title="TabLayout与ViewPager的搭配使用分析"></a>TabLayout与ViewPager的搭配使用分析</h1><p>恩，我每次都是和ViewPager搭配使用的，从来没有像上面那样用过，使用方法很简单。<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">mTabLayout.setupWithViewPager(mPager);</div></pre></td></tr></table></figure></p>
<p>传入的为ViewPager的实例。<br>越简单的使用，说明这个方法内部替我们做了很多事情，肯定是要从这个方法开始分析的。<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setupWithViewPager</span><span class="params">(@Nullable <span class="keyword">final</span> ViewPager viewPager)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mViewPager != <span class="keyword">null</span> &amp;&amp; mPageChangeListener != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// If we've already been setup with a ViewPager, remove us from it</span></div><div class="line">            mViewPager.removeOnPageChangeListener(mPageChangeListener);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (viewPager != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">final</span> PagerAdapter adapter = viewPager.getAdapter();</div><div class="line">            <span class="keyword">if</span> (adapter == <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"ViewPager does not have a PagerAdapter set"</span>);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            mViewPager = viewPager;</div><div class="line"></div><div class="line">            <span class="comment">// Add our custom OnPageChangeListener to the ViewPager</span></div><div class="line">            <span class="keyword">if</span> (mPageChangeListener == <span class="keyword">null</span>) &#123;</div><div class="line">                mPageChangeListener = <span class="keyword">new</span> TabLayoutOnPageChangeListener(<span class="keyword">this</span>);</div><div class="line">            &#125;</div><div class="line">            mPageChangeListener.reset();</div><div class="line">            viewPager.addOnPageChangeListener(mPageChangeListener);</div><div class="line"></div><div class="line">            <span class="comment">// Now we'll add a tab selected listener to set ViewPager's current item</span></div><div class="line">            setOnTabSelectedListener(<span class="keyword">new</span> ViewPagerOnTabSelectedListener(viewPager));</div><div class="line"></div><div class="line">            <span class="comment">// Now we'll populate ourselves from the pager adapter</span></div><div class="line">            setPagerAdapter(adapter, <span class="keyword">true</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// We've been given a null ViewPager so we need to clear out the internal state,</span></div><div class="line">            <span class="comment">// listeners and observers</span></div><div class="line">            mViewPager = <span class="keyword">null</span>;</div><div class="line">            setOnTabSelectedListener(<span class="keyword">null</span>);</div><div class="line">            setPagerAdapter(<span class="keyword">null</span>, <span class="keyword">true</span>);</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>看到，如果我们的TabLayout已经和一个ViewPager相互连接，那么先移除PageChangeListener，即解除连接。之后获取传入的ViewPager的Adapter，然后……好吧，最关键的是下面三个方法。<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line">viewPager.addOnPageChangeListener(mPageChangeListener);</div><div class="line"><span class="comment">// Now we'll add a tab selected listener to set ViewPager's current item</span></div><div class="line">setOnTabSelectedListener(<span class="keyword">new</span> ViewPagerOnTabSelectedListener(viewPager));</div><div class="line"><span class="comment">// Now we'll populate ourselves from the pager adapter</span></div><div class="line">setPagerAdapter(adapter, <span class="keyword">true</span>);</div></pre></td></tr></table></figure></p>
<p>给传入的ViewPager设置了PageChangeListener，这个PageChangeListener是在TabLayout中定义的<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TabLayoutOnPageChangeListener</span> <span class="keyword">implements</span> <span class="title">ViewPager</span>.<span class="title">OnPageChangeListener</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> WeakReference&lt;TabLayout&gt; mTabLayoutRef;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> mPreviousScrollState;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> mScrollState;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">TabLayoutOnPageChangeListener</span><span class="params">(TabLayout tabLayout)</span> </span>&#123;</div><div class="line">            mTabLayoutRef = <span class="keyword">new</span> WeakReference&lt;&gt;(tabLayout);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageScrollStateChanged</span><span class="params">(<span class="keyword">int</span> state)</span> </span>&#123;</div><div class="line">            mPreviousScrollState = mScrollState;</div><div class="line">            mScrollState = state;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageScrolled</span><span class="params">(<span class="keyword">int</span> position, <span class="keyword">float</span> positionOffset,</span></span></div><div class="line">                <span class="keyword">int</span> positionOffsetPixels) &#123;</div><div class="line">            <span class="keyword">final</span> TabLayout tabLayout = mTabLayoutRef.get();</div><div class="line">            <span class="keyword">if</span> (tabLayout != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="comment">// Only update the text selection if we're not settling, or we are settling after</span></div><div class="line">                <span class="comment">// being dragged</span></div><div class="line">                <span class="keyword">final</span> <span class="keyword">boolean</span> updateText = mScrollState != SCROLL_STATE_SETTLING ||</div><div class="line">                        mPreviousScrollState == SCROLL_STATE_DRAGGING;</div><div class="line">                <span class="comment">// Update the indicator if we're not settling after being idle. This is caused</span></div><div class="line">                <span class="comment">// from a setCurrentItem() call and will be handled by an animation from</span></div><div class="line">                <span class="comment">// onPageSelected() instead.</span></div><div class="line">                <span class="keyword">final</span> <span class="keyword">boolean</span> updateIndicator = !(mScrollState == SCROLL_STATE_SETTLING</div><div class="line">                        &amp;&amp; mPreviousScrollState == SCROLL_STATE_IDLE);</div><div class="line">                tabLayout.setScrollPosition(position, positionOffset, updateText, updateIndicator);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageSelected</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</div><div class="line">            <span class="keyword">final</span> TabLayout tabLayout = mTabLayoutRef.get();</div><div class="line">            <span class="keyword">if</span> (tabLayout != <span class="keyword">null</span> &amp;&amp; tabLayout.getSelectedTabPosition() != position) &#123;</div><div class="line">                <span class="comment">// Select the tab, only updating the indicator if we're not being dragged/settled</span></div><div class="line">                <span class="comment">// (since onPageScrolled will handle that).</span></div><div class="line">                <span class="keyword">final</span> <span class="keyword">boolean</span> updateIndicator = mScrollState == SCROLL_STATE_IDLE</div><div class="line">                        || (mScrollState == SCROLL_STATE_SETTLING</div><div class="line">                        &amp;&amp; mPreviousScrollState == SCROLL_STATE_IDLE);</div><div class="line">                tabLayout.selectTab(tabLayout.getTabAt(position), updateIndicator);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span> </span>&#123;</div><div class="line">            mPreviousScrollState = mScrollState = SCROLL_STATE_IDLE;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>恩，就是很简单的，当ViewPager滑动时，让TabLayout滑动到相应的位置。这个Listener使得TabLayout的状态可以更随ViewPager的滑动而做出相应的改变。<br>接下来看setOnTabSelectedListener(new ViewPagerOnTabSelectedListener(viewPager))这个方法，可以看到关键是传入的ViewPagerOnTabSelectedListener对象，这个也是在TabLayout内部定义的<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewPagerOnTabSelectedListener</span> <span class="keyword">implements</span> <span class="title">TabLayout</span>.<span class="title">OnTabSelectedListener</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> ViewPager mViewPager;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ViewPagerOnTabSelectedListener</span><span class="params">(ViewPager viewPager)</span> </span>&#123;</div><div class="line">            mViewPager = viewPager;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabSelected</span><span class="params">(TabLayout.Tab tab)</span> </span>&#123;</div><div class="line">            mViewPager.setCurrentItem(tab.getPosition());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabUnselected</span><span class="params">(TabLayout.Tab tab)</span> </span>&#123;</div><div class="line">            <span class="comment">// No-op</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTabReselected</span><span class="params">(TabLayout.Tab tab)</span> </span>&#123;</div><div class="line">            <span class="comment">// No-op</span></div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以看到，在onTabSelected()方法中操作了ViewPager的状态，通过这个Listener就使得在TabLayout的状态发生变化时通知ViewPager发生相应的改变。</p>
<p>再来看第三个方法<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setPagerAdapter</span><span class="params">(@Nullable <span class="keyword">final</span> PagerAdapter adapter, <span class="keyword">final</span> <span class="keyword">boolean</span> addObserver)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mPagerAdapter != <span class="keyword">null</span> &amp;&amp; mPagerAdapterObserver != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// If we already have a PagerAdapter, unregister our observer</span></div><div class="line">            mPagerAdapter.unregisterDataSetObserver(mPagerAdapterObserver);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        mPagerAdapter = adapter;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (addObserver &amp;&amp; adapter != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// Register our observer on the new adapter</span></div><div class="line">            <span class="keyword">if</span> (mPagerAdapterObserver == <span class="keyword">null</span>) &#123;</div><div class="line">                mPagerAdapterObserver = <span class="keyword">new</span> PagerAdapterObserver();</div><div class="line">            &#125;</div><div class="line">            adapter.registerDataSetObserver(mPagerAdapterObserver);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// Finally make sure we reflect the new adapter</span></div><div class="line">        populateFromPagerAdapter();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>令ViewPager的Adapter注册了数据观察器，即当我们调用adapter的notifyDataSetChanged()之类方法时会使TabLayout也做出数据的变化。最后调用的populateFromPagerAdapter()方法，令改变生效，让TabLayout的Tab数以及Tab的Text与ViewPager相一致。<br><figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">populateFromPagerAdapter</span><span class="params">()</span> </span>&#123;</div><div class="line">        removeAllTabs();</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (mPagerAdapter != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> adapterCount = mPagerAdapter.getCount();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; adapterCount; i++) &#123;</div><div class="line">                addTab(newTab().setText(mPagerAdapter.getPageTitle(i)), <span class="keyword">false</span>);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">// Make sure we reflect the currently set ViewPager item</span></div><div class="line">            <span class="keyword">if</span> (mViewPager != <span class="keyword">null</span> &amp;&amp; adapterCount &gt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">final</span> <span class="keyword">int</span> curItem = mViewPager.getCurrentItem();</div><div class="line">                <span class="keyword">if</span> (curItem != getSelectedTabPosition() &amp;&amp; curItem &lt; getTabCount()) &#123;</div><div class="line">                    selectTab(getTabAt(curItem));</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            removeAllTabs();</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>更新方法也比较简单，就是先清空所有以后的Tab，然后根据ViewPager中的信息创建新的Tab。</p>

	
	
	
	
</div>
				
				

                <!-- Post Comments -->
                
                    
    <!-- 使用多说评论 -->
    <link rel="stylesheet" href="/css/duoshuo.min.css">
<style>
    #ds-thread #ds-reset .ds-post-button{
        background-color: #0097A7 !important;
    }
    #ds-wrapper #ds-reset .ds-icons-32{
        background-color: #0097A7 !important;
    }
    #ds-reset .ds-highlight {
        color: #0097A7 !important;
    }
</style>
<div id="comments">
    <!-- 多说评论框 start -->
        <div class="ds-thread" 
            data-thread-key="2016/09/08/Android TabLayout分析/" 
            data-url="http://wuapnjie.github.io/2016/09/08/Android TabLayout分析/"
            data-title="Android TabLayout分析"></div>
    <!-- 多说评论框 end -->
</div>



                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    
    <!-- Prev Nav -->
    
        <a href="/2016/09/08/Android Camera2学习笔记/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2016/09/08/Android Studio导入字体/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>
        </div>
    </div>

				
				
					<!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay "></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored  sidebar-fixed-left" role="navigation">
	<div id="sidebar-main">
	    <!-- Sidebar Header -->
		<div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
    <i class="material-icons">clear_all</i>
    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Snowbean's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        wupanjie0611@email.com
        <b class="caret"></b>
    </a>
</div>

		<!-- Sidebar Navigation  -->
		<ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
			
                <li>
                    <a href="#" target="_blank" title="Email Me">
						<i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    <li id="sidebar-first-li">
        <a href="/" target="_self">
            <i class="material-icons sidebar-material-icons">home</i>
             主页
        </a>
    </li>

    <!-- I'm Feeling Lucky -->
<!--
    <li class="dropdown">
        <a href="" target="_self">
            <i class="material-icons sidebar-material-icons">explore</i>
             sidebar.imlucky
        </a>
    </li>
-->

	
    <!-- Archives  -->
    <li class="dropdown">
        <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
            <i class="material-icons sidebar-material-icons">inbox</i>
             归档
            <b class="caret"></b>
        </a>
        <ul class="dropdown-menu">
            <li>
            <a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/12/">十二月 2016<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">6</span></a>
        </ul>
    </li>

    <!-- Divider -->
    <li class="divider"></li>


    <!-- Pages  -->
	

    <!-- Article Numebr  -->
    <li>
        <a href="/archives">
             文章总数
             <span class="sidebar-badge">21</span>
        </a>
    </li>
</ul>

		<!-- Sidebar Divider -->
		<div class="sidebar-divider"></div>

		<!-- Sidebar Footer -->
		<!-- 
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持。 :) 
-->

<!-- Theme Material -->
<a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
	<div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		主题 - Material
		<span class="sidebar-badge badge-circle">i</span>
	</div>
</a>

<!-- Help & Support -->
<!--
<a href="mailto:hiviosey@gmail.com" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
		sidebar.help
		<span class="mdl-button__ripple-container">
			<span class="mdl-ripple"></span>
		</span>
	</div>
</a>
-->

<!-- Feedback -->
<!--
<a href="https://github.com/viosey/hexo-theme-material/issues" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.feedback
                    <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>
-->

<!-- Abount Theme -->
<!--
<a href="https://blog.viosey.com/index.php/Material.html" target="_blank" class="sidebar-footer-text-a">
    <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
         sidebar.about_theme
        <span class="mdl-button__ripple-container"><span class="mdl-ripple"></span></span></div>
</a>-->

	</div>
    
    <!-- Sidebar Sponsor -->
    


</aside>

				
				
				
					<!-- Footer Top Button -->
					<div class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>
				
				
				<!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
	
	
		<!-- Paradox Footer Left Section -->
		<div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    
    <a href="https://twitter.com/twitter" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-twitter.png);">
        <span class="visuallyhidden">Twitter</span>
    </button></a>
    
    
    <!-- Facebook -->
    
    <a href="https://www.facebook.com/facebook" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-facebook.png);">
        <span class="visuallyhidden">Facebook</span>
    </button></a>
    
    
    <!-- Google + -->
    
    <a href="https://www.google.com/" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-gplus.png);">
        <span class="visuallyhidden">Google Plus</span>
    </button></a>
    
    
    <!-- Weibo -->
    
    
    
    <!-- Instagram -->
    
    
    
    <!-- Tumblr -->
    
    
    
    <!-- Github -->
    
    <a href="https://github.com/wuapnjie" target="view_window"><button class="mdl-mini-footer--social-btn social-btn" style="background-image: url(/img/footer/footer_ico-github.png);">
        <span class="visuallyhidden">Github</span>
    </button></a>
    
</div>


		<!--Copyright-->
		<div id="copyright">Copyright&nbsp;©&nbsp;<script type="text/javascript">var fd = new Date();document.write(fd.getFullYear());</script>&nbsp;Snowbean's Blog</div>

		<!-- Paradox Footer Right Section -->

		<!-- 
		I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright.
		It will not impact the appearance and can give developers a lot of support :)

		很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
		它不会影响美观并可以给开发者很大的支持。 :) 
		-->

		<div class="mdl-mini-footer--right-section">
			<div>
				<div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
				<div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
			</div>
		</div>
	
    
</footer>
                
				<!-- Import File -->
<script src="/js/highlight.min.js"></script>
<script src="/js/js.min.js"></script>
<script src="/js/nprogress.js"></script>

<script type="text/javascript">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    
    $('#nprogress .bar').css({
        'background': '#FF4081'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #FF4081, 0 0 15px #FF4081'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#FF4081',
        'border-left-color': '#FF4081'
    });
    
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>








    <!-- 多说公共 js 代码 start -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:"wuapnjie"};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = 'https://static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] 
             || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
    </script>
    <!-- 多说公共 js 代码 end -->




<!-- Swiftye -->


<!-- Local Search-->


<!-- Window Load-->
<script>
    $(window).load(function() {
        // Post_Toc parent position fixed
        $(".post-toc-wrap").parent(".mdl-menu__container").css("position", "fixed");
    });
</script>

<!-- MathJax Load-->

            </main>
        </div>
		
    </body>
		
	
</html>
